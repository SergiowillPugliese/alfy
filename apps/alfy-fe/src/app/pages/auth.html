<div class="flex align-items-center justify-content-center min-h-screen bg-primary-50">
  <p-card class="w-full max-w-md mx-3" styleClass="shadow-3">
    <ng-template pTemplate="header">
      <div class="text-center py-4">
        <h2 class="text-3xl font-bold text-900 mb-2">
          {{ isLoginMode ? 'Accedi' : 'Registrati' }}
        </h2>
        <p class="text-600 text-lg">
          {{ isLoginMode ? 'Accedi al tuo account Alfy' : 'Crea il tuo account Alfy' }}
        </p>
      </div>
    </ng-template>

    <form [formGroup]="authForm" (ngSubmit)="onSubmit()" class="flex flex-column gap-4">
      <!-- Nome e Cognome (solo per registrazione) -->
      <div *ngIf="!isLoginMode" class="flex gap-3">
        <div class="flex-1">
          <label for="firstName" class="block text-900 font-medium mb-2">Nome</label>
          <input
            pInputText
            id="firstName"
            formControlName="firstName"
            placeholder="Inserisci il tuo nome"
            class="w-full"
            [class.ng-invalid]="isFieldInvalid('firstName')"
            [class.ng-dirty]="isFieldInvalid('firstName')"
          />
          <small *ngIf="isFieldInvalid('firstName')" class="p-error block mt-1">
            Il nome è obbligatorio
          </small>
        </div>
        
        <div class="flex-1">
          <label for="lastName" class="block text-900 font-medium mb-2">Cognome</label>
          <input
            pInputText
            id="lastName"
            formControlName="lastName"
            placeholder="Inserisci il tuo cognome"
            class="w-full"
            [class.ng-invalid]="isFieldInvalid('lastName')"
            [class.ng-dirty]="isFieldInvalid('lastName')"
          />
          <small *ngIf="isFieldInvalid('lastName')" class="p-error block mt-1">
            Il cognome è obbligatorio
          </small>
        </div>
      </div>

      <!-- Email -->
      <div>
        <label for="email" class="block text-900 font-medium mb-2">Email</label>
        <input
          pInputText
          id="email"
          type="email"
          formControlName="email"
          placeholder="Inserisci la tua email"
          class="w-full"
          [class.ng-invalid]="isFieldInvalid('email')"
          [class.ng-dirty]="isFieldInvalid('email')"
        />
        <small *ngIf="isFieldInvalid('email')" class="p-error block mt-1">
          <span *ngIf="authForm.get('email')?.errors?.['required']">L'email è obbligatoria</span>
          <span *ngIf="authForm.get('email')?.errors?.['email']">Inserisci un'email valida</span>
        </small>
      </div>

      <!-- Password -->
      <div>
        <label for="password" class="block text-900 font-medium mb-2">Password</label>
        <p-password
          formControlName="password"
          placeholder="Inserisci la tua password"
          styleClass="w-full"
          inputStyleClass="w-full"
          [feedback]="false"
          [toggleMask]="true"
          [class.ng-invalid]="isFieldInvalid('password')"
          [class.ng-dirty]="isFieldInvalid('password')"
        />
        <small *ngIf="isFieldInvalid('password')" class="p-error block mt-1">
          <span *ngIf="authForm.get('password')?.errors?.['required']">La password è obbligatoria</span>
          <span *ngIf="authForm.get('password')?.errors?.['minlength']">La password deve essere di almeno 6 caratteri</span>
        </small>
      </div>

      <!-- Error Message -->
      <p-message
        *ngIf="errorMessage"
        severity="error"
        [text]="errorMessage"
        styleClass="w-full"
      />

      <!-- Submit Button -->
      <p-button
        type="submit"
        [label]="isLoading ? 'Caricamento...' : (isLoginMode ? 'Accedi' : 'Registrati')"
        [loading]="isLoading"
        [disabled]="authForm.invalid || isLoading"
        styleClass="w-full"
        size="large"
      />
    </form>

    <ng-template pTemplate="footer">
      <div class="text-center pt-3">
        <p class="text-600 mb-0">
          {{ isLoginMode ? 'Non hai un account?' : 'Hai già un account?' }}
          <button
            type="button"
            class="p-button-link p-0 ml-1 vertical-align-baseline"
            (click)="toggleMode()"
          >
            {{ isLoginMode ? 'Registrati' : 'Accedi' }}
          </button>
        </p>
      </div>
    </ng-template>
  </p-card>
</div>
